---
title: "Pollutantmean Solution Discussion"
author: "lars pijnappel"
date: "28 juli 2015"
output: html_document
---

By [Derek Franks][coursera] (see also his [Github profile][gh])

source: https://class.coursera.org/rprog-030/forum/thread?thread_id=994

---

## Solution 1
> Using for loop - importing complete dataset

```{r}
s1.pollutantmean <- function(directory, pollutant, id = 1:332) {
    setwd('../../02. R Programming/Quizzes')

    files_list <- dir(directory, full.names=TRUE)        
    dat <- data.frame()                                  
    for (i in id) {                                      
            dat <- rbind(dat, read.csv(files_list[i]))
    }
    mean(dat[, pollutant], na.rm=T)                      
}

system.time( s1 <- s1.pollutantmean('specdata', 'nitrate') )
s1
```


## Solution 2
> Using vectors vs. data frames - importing only pollutant variable

```{r}
s2.pollutantmean <- function(directory, pollutant, id = 1:332) {
    setwd('../../02. R Programming/Quizzes')

    files_list <- dir(directory, full.names=TRUE)
    dat <- as.numeric()
    for (i in id) {
            dat <- c(dat, read.csv(files_list[i])[, pollutant])
    }
    mean(dat, na.rm=T)                      
}

system.time( s2 <- s2.pollutantmean('specdata', 'nitrate') )
s2
```


## Solution 3

> a. Functions lapply & do.call - importing complete dataset

```{r}
setwd('../../02. R Programming/Quizzes')

files_list <- dir("specdata", full.names=TRUE)
system.time( dat_temp <- lapply(files_list, read.csv) )
```


```{r}
s3a.pollutantmean <- function(directory, pollutant, id = 1:332) {
    setwd('../../02. R Programming/Quizzes')

    files_list <- dir(directory, full.names=TRUE)      
    dat_temp <- lapply(files_list[id], read.csv)
    dat <- do.call(rbind, dat_temp)
    mean(dat[, pollutant], na.rm=T)                
}

system.time( s3a <- s3a.pollutantmean('specdata', 'nitrate') )
s3a
```

> b. Functions tidyr & dplyr - importing complete dataset

```{r}
s3b.pollutantmean <- function(directory, pollutant, id = 1:332) {
  library("tidyr")
  library("dplyr")
  setwd('../../02. R Programming/Quizzes')

  dat <- do.call(rbind, lapply(dir("specdata", full.names=TRUE), read.csv))
  dat_tidy <- gather(dat, pollutant, reading, 2:3)
  dat_tidy %>% group_by(pollutant) %>% summarise(mean_reading = mean(reading, na.rm=T))
}

system.time( s3b <- s3b.pollutantmean('specdata') )
s3b
```

> c. Functions by & tapply - importing complete dataset

```{r}
s3c1.pollutantmean <- function(directory, pollutant, id = 1:332) {
  library("tidyr")
  library("dplyr")
  setwd('../../02. R Programming/Quizzes')

  dat <- do.call(rbind, lapply(dir("specdata", full.names=TRUE), read.csv))
  dat_tidy <- gather(dat, pollutant, reading, 2:3)
  by(dat_tidy$reading, dat_tidy$pollutant, mean, na.rm=T)
}

s3c2.pollutantmean <- function(directory, pollutant, id = 1:332) {
  library("tidyr")
  library("dplyr")
  setwd('../../02. R Programming/Quizzes')

  dat <- do.call(rbind, lapply(dir("specdata", full.names=TRUE), read.csv))
  dat_tidy <- gather(dat, pollutant, reading, 2:3)
  tapply(dat_tidy$reading, dat_tidy$pollutant, mean, na.rm=T)
}

system.time( s3c1 <- s3c1.pollutantmean('specdata') )
#system.time( s3c1 <- by(dat_tidy$reading, dat_tidy$pollutant, mean, na.rm=T) )
system.time( s3c2 <- s3c2.pollutantmean('specdata') )
#system.time( s3c2 <- tapply(dat_tidy$reading, dat_tidy$pollutant, mean, na.rm=T) )
table(s3c1, s3c2)
```


## Solution 4
> Using anonymous function & lapply - importing only pollutant variable

```{r}
s4.pollutantmean <- function(directory, pollutant, id = 1:332) {
    setwd('../../02. R Programming/Quizzes')

    files_list <- dir(directory, full.names=TRUE)
    dat <- lapply(files_list[id], function(x) read.csv(x)[[pollutant]])
    mean(unlist(dat), na.rm=T)                      
}

system.time( s4 <- s4.pollutantmean("specdata",'nitrate') )
s4
```


## Solution 5
> Using data.table

```{r}
library(data.table)
s5.pollutantmean.dt <- function(directory, pollutant, id = 1:332) {
    setwd('../../02. R Programming/Quizzes')

    files <- list.files(directory, full.names = T)[id]
    dt <- rbindlist(lapply(files, fread, header=T, na.strings="NA"))
    mean(dt[[pollutant]], na.rm=T)
}

system.time( s5 <- s5.pollutantmean.dt('specdata', 'nitrate') )
s5
```


[coursera]: https://class.coursera.org/rprog-030/forum/profile?user_id=5001733
[gh]: https://github.com/derekfranks