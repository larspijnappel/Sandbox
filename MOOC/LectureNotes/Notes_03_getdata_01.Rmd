---
title: "Lectures notes"
author: "lars pijnappel"
date: "10 september 2015"
output: html_document
---

***
***Orginal stuff is coming from the GitHub repository [DataScienceSpecialization](https://github.com/DataScienceSpecialization) > Courses > [03_GettingData](https://github.com/DataScienceSpecialization/courses/tree/master/03_GettingData).***

***

# Table of Contents

* [CSV and Excel files](#CSV-and-Excel-files)
* [XML files](#xml-files)
    * [XPath](#xpath)
* [JSON](#json)
* [Cleanup file system](#cleanup-file-system)

_Note: To get a sublist, press 4x space ( or a multiply of it, to get a sub-sublist)_

***

# CSV and Excel files 
[ToC](#table-of-contents)

## 01_04_downLoadingFiles.pdf

```{r}
getwd()

if ( !file.exists( "data" )) {
        dir.create( "data" )
}
dir( )
# file.remove( "data" )
# dir()
```

### download csv
```{r}
## folder references './data' and 'data' both works..

fileURL <- "https://data.baltimorecity.gov/api/views/dz54-2aru/rows.csv?accessType=DOWNLOAD"
## w/o method argument, function results in an error when Knitting it (CTRL-SHIFT-K)
download.file( fileURL, destfile = "./data/cameras.csv", method="wininet")
list.files( "data" )
```

## 01_05_readingLocalFiles.pdf

```{r}
# read.table() expects by default tab separated data and no header included.
cameraData_csv <- read.table( "./data/cameras.csv", sep=",", header = TRUE )
head( cameraData_csv )
```

## 01_06_readingExcelFiles.pdf

### download xlsx
```{r}
if ( !file.exists("data") ) dir.create("data")

fileURL <- "https://data.baltimorecity.gov/api/views/dz54-2aru/rows.xlsx?accessType=DOWNLOAD"
## w/o mode argument, the donwloaded xlsx gets corrupted (can't be opened in Excel)
download.file( fileURL, destfile = "./data/cameras.xlsx", method="wininet", mode="wb")
list.files( "data" )


dateDownloaded <- date()
dateDownloaded
```

### Different ways reading the xlsx file
```{r}
## this library requires java (64-bit > http://www.java.com/en/download/manual.jsp )..
library( xlsx, quietly = TRUE )
cameraData_xlsx <- read.xlsx( "./data/cameras.xlsx", sheetIndex = 1, header = TRUE)

## following library doesn't require java..
library( readxl )
cameraData_rxl <- read_excel( "./data/cameras.xlsx" )

## XLConnect package has more options for writing/manipulating Excel files.
## https://cran.r-project.org/web/packages/XLConnect/vignettes/XLConnect.pdf
library( XLConnect, quietly = TRUE )
cameraData_xlc <- loadWorkbook( "./data/cameras.xlsx" )

## apparently, the rxl-object differs with both the csv- and xlsx-object
identical( cameraData_csv, cameraData_xlsx )
identical( cameraData_csv, cameraData_rxl )
identical( cameraData_xlsx, cameraData_rxl )
## same applies for the xlc-object
identical( cameraData_xlc, cameraData_csv )
identical( cameraData_xlc, cameraData_xlsx )
identical( cameraData_xlc, cameraData_rxl )


i_col <- 2:3
i_row <- 1:4
cameraData_xlsx_Subset <- read.xlsx( "./data/cameras.xlsx", sheetIndex = 1, colIndex = i_col, rowIndex = i_row )
cameraData_xlsx_Subset
```


# XML files 
[ToC](#table-of-contents)

## 01_07_readingXML.pdf

Following examples are taken from [w3schools](http://www.w3schools.com/xml/simple.xml)

### Read file into R
```{r}
library(XML)

fileURL <- "http://www.w3schools.com/xml/simple.xml"
doc <- xmlTreeParse( fileURL, useInternal=TRUE )
rootNode <- xmlRoot( doc )
xmlName( rootNode )
names( rootNode )
```

### Directly accessing parts of the XML
```{r}
rootNode[[1]]
rootNode[[1]][[1]]
```

### Programatically accessing parts of the XML
```{r}
xmlSApply( rootNode, xmlValue )
```

### XPath
[ToC](#table-of-contents)

    * /node Top level node
    * //node Node at any level
    * node[@attr-name] Node with an attribute name
    * node[@attr-name='bob'] Node with attribute name attr-name='bob'

Information from: http://www.stat.berkeley.edu/~statcur/Workshop2/Presentations/XML.pdf
```{r}
xpathSApply(rootNode,"//name",xmlValue)
xpathSApply(rootNode,"//price",xmlValue)
```

### XPath - another example (html)
http://espn.go.com/nfl/team/_/name/bal/baltimore-ravens

With htmlTreeParse you basically read the source of the webpage.
```{r}
fileUrl <- "http://espn.go.com/nfl/team/_/name/bal/baltimore-ravens"
doc <- htmlTreeParse( fileUrl, useInternal = TRUE )
scores <- xpathSApply( doc, "//div[@class='score']", xmlValue )         ## <div class="score">
teams <- xpathSApply( doc, "//li[@class='team-name']", xmlValue )       ## <li class="team-name">
scores
teams


## xmlValue: raw contents of leaf nodes (which have no children nodes)
gamemeta <- xpathSApply( doc, "//div[@class='game-meta']", xmlValue)  ## <div class="game-meta">
gamemeta
## xmlChildren: returns a list of child XMLNode objects within an XMLNode object
gamemeta <- xpathSApply( doc, "//div[@class='game-meta']", xmlChildren) 
head(gamemeta, 2)
## xmlName: element or tag name introduced in the <name ...> entry in an XML document
gamemeta <- xpathSApply( doc, "//div[@class='game-meta']", xmlName)
gamemeta
## xmlAttrs: name-value pairs of attributes
gamemeta <- xpathSApply( doc, "//div[@class='game-meta']", xmlAttrs)
gamemeta

```

## Notes and further resources

* Official XML tutorials [short](http://www.omegahat.org/RSXML/shortIntro.pdf), [long](http://www.omegahat.org/RSXML/Tour.pdf)
* An [outstanding guide to the XML package](http://www.stat.berkeley.edu/%7Estatcur/Workshop2/Presentations/XML.pdf)

# JSON
## 01_08_readingJSON.pdf
[ToC](#table-of-contents)

# Cleanup file system
[ToC](#table-of-contents)
Remove the created data folder (incl. its downloaded files).

```{r}
unlink( "data" , recursive = TRUE)
```

